---
title: 'Project 1: Wrangling, Exploration, Visualization'
author: "SDS322E"
date: ''
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F,
tidy=TRUE, tidy.opts=list(width.cutoff=60), R.options=list(max.print=100))
```

## Data Wrangling, Exploration, Visualization

### Sahith Kasireddy

#### Introduction 

My two dataset are statistical data related to countries. One dataset, hif is about the different examples of freedom from political scientists. The other dataset, CountryDataSet, deals with the number of people leaving a country to a different country. I am interested in this dataset because I am really interested in cultures and the social and political systems of countries. I therefore wanted to see the relationship between the amount of people leaving a country and the country's freedom index.

```{R}
library(dplyr)
library(tidyverse)
hfi <- read.csv(file = 'hfi.csv')
UNImmigration <- read.csv(file ='CountryDataSet2.0.csv')

```

#### Tidying: Reshaping

If your datasets are tidy already, demonstrate that you can reshape data with pivot wider/longer here (e.g., untidy and then retidy). Alternatively, it may be easier to wait until the wrangling section so you can reshape your summary statistics. Note here if you are going to do this.

```{R}
UNImmigration <- UNImmigration %>% pivot_longer(8:242, names_to="Country of Origin", values_to="Number of People Immigrating Out of Country")

```

    
#### Joining/Merging

```{R}

UNImmigration %>% count()
hfi %>% count()

UNImmigration<- UNImmigration %>% rename("Country/Region of Destination" = Major.area..region..country.or.area.of.destination) %>% select(-c(1,3, 5:7)) 

UNImmigration<- UNImmigration %>% filter(`Country/Region of Destination`!="UN development groups" & `Country/Region of Destination`!="World Bank income groups" & `Country/Region of Destination`!="Geographic regions" & `Country/Region of Destination`!="WORLD" & `Country/Region of Destination`!="More developed regions" & `Country/Region of Destination`!="Less developed regions" & `Country/Region of Destination`!="Least developed countries" & `Country/Region of Destination`!="Less developed regions, excluding least developed countries" & `Country/Region of Destination`!="High-income countries" & `Country/Region of Destination`!="Middle-income countries" & `Country/Region of Destination`!="Upper-middle-income countries" & `Country/Region of Destination`!="Lower-middle-income countries" & `Country/Region of Destination`!="Low-income countries" & `Country/Region of Destination`!="No income group available" & `Country/Region of Destination`!="Sustainable Development Goal (SDG) regions")


UNImmigration<- UNImmigration %>% mutate(`Country of Origin`=str_replace_all(`Country of Origin`, "\\.", " ")) 

UNImmigration$`Country of Origin` <- str_replace_all(UNImmigration$`Country of Origin`, c("Bolivia  Plurinational State of" ="Bolivia", "Central African Republic" ="Central Afr. Rep.", 
 "Cabo Verde" ="Cape Verde", "Congo" ="Congo, Rep. Of", "Democratic Republic of the Congo" ="Congo, Dem. R.", "China  Hong Kong SAR" ="Hong Kong", "Czechia" ="Czech Rep.", "Dominican Republic" ="Dominican Rep.", 
 "Gambia"= "Gambia, The", "Guinea Bissau"="Guinea-Bissau", "Iran  Islamic Republic of" ="Iran", "Lao People s Democratic Republic" ="Laos", "Republic of Korea" ="Korea, South", 
 "Kyrgyzstan" ="Kyrgyz Republic", "Papua New Guinea" ="Pap. New Guinea", "Republic of Moldova" ="Moldova", "Russian Federation" ="Russia", "Slovakia"="Slovak Rep.", "Syrian Arab Republic" ="Syria", 
 "Timor Leste" ="Timor-Leste", "United Republic of Tanzania" ="Tanzania", "United States of America" ="United States", "Venezuela  Bolivarian Republic of" ="Venezuela", 
 "Viet Nam" ="Vietnam", "Yemen" ="Yemen, Rep.", "Eswatini" ="Swaziland"))

UNImmigration$`Country of Origin` <-str_replace_all(UNImmigration$`Country of Origin`, "Congo, Dem. R., Rep. Of", "Congo, Dem. R.")

UNImmigration <- UNImmigration %>% filter(`Country/Region of Destination`!="Africa" & `Country/Region of Destination`!="Asia" & `Country/Region of Destination`!="Caribbean" & 
`Country/Region of Destination`!="Central America"& `Country/Region of Destination`!="Central Asia" & `Country/Region of Destination`!="Eastern Africa" & `Country/Region of Destination`!="Western Europe" & 
`Country/Region of Destination`!="Africa" & `Country/Region of Destination`!="Asia" & `Country/Region of Destination`!="Central America"& `Country/Region of Destination`!="Central Asia" & 
`Country/Region of Destination`!="Eastern Africa" & `Country/Region of Destination`!="Western Europe" & `Country/Region of Destination`!="CENTRAL AND SOUTHERN ASIA" & 
`Country/Region of Destination`!="EASTERN AND SOUTH-EASTERN ASIA" & `Country/Region of Destination`!="Eastern Asia"& `Country/Region of Destination`!="Eastern Europe" & 
`Country/Region of Destination`!="Europe" & `Country/Region of Destination`!="EUROPE" & `Country/Region of Destination`!="Australia / New Zealand" & `Country/Region of Destination`!="EUROPE AND NORTHERN AMERICA" & 
`Country/Region of Destination`!="Latin America and the Caribbean" & `Country/Region of Destination`!="LATIN AMERICA AND THE CARIBBEAN" & `Country/Region of Destination`!="Asia" & 
`Country/Region of Destination`!="Middle Africa" & `Country/Region of Destination`!="Northern Africa" & `Country/Region of Destination`!="NORTHERN AFRICA AND WESTERN ASIA" & 
`Country/Region of Destination`!="Northern America" & `Country/Region of Destination`!="NORTHERN AMERICA" & `Country/Region of Destination`!="Northern Europe" & `Country/Region of Destination`!="OCEANIA" & 
`Country/Region of Destination`!="Oceania" & `Country/Region of Destination`!="South America" & `Country/Region of Destination`!="South-Eastern Asia" & `Country/Region of Destination`!="Southern Africa" & 
`Country/Region of Destination`!="Southern Asia" & `Country/Region of Destination`!="Southern Europe" & `Country/Region of Destination`!="SUB-SAHARAN AFRICA" & `Country/Region of Destination`!="Western Africa" & 
`Country/Region of Destination`!="Western Asia")

UNImmigration <- UNImmigration %>% filter(`Country of Origin`!="Total" & `Country of Origin`!="Other North" & `Country of Origin`!="Other South")

hfi <- hfi %>% rename("Country of Origin" = `countries`, "Year" = year)
UNImmigration %>% count()
hfi %>% count()

joinedDataSet <- inner_join(UNImmigration, hfi, by=c("Country of Origin","Year"))

#joinedDataSet <- full_join(UNImmigration, hfi, by=c("Country of Origin","Year"))

```

After tidying (pivot_longer) the UnImmigration data, the calculated number of observations in this dataset appears to be 73320. After doing the appropriate data cleaning with dpylr (in order to get rid of extraneous variables and make sure that the country names that were matched between the two datasets were spelled the same), the number of calculated observations in the UnImmigration and hfi datasets appear to be 381640 and 1458 respectively,   An inner join was performed in order to see match the data values from the UNImmigration dataset to the hfi dataset. Right before joining the datasets, there are two unique ID variables in the UNImmigration dataset: "Country/Region of Destination" and "Number of People Immigrating Out of Country". The unique ID variables in the hfi dataset are numerous. 

####  Wrangling

```{R}
#Cleaning data further and selecting only interested variables
joinedDataSet<- joinedDataSet %>% mutate_all(na_if,"")
joinedDataSet<- joinedDataSet %>% mutate_all(na_if,"..")
joinedDataSet<- joinedDataSet %>% select(-c(5:6))

joinedDataSet <- joinedDataSet %>% select(c(1:5), pf_religion, pf_identity_sex, pf_rol_procedural, pf_ss_disappearances_disap, pf_movement_women, pf_association_association, pf_association_assembly, pf_expression, pf_identity_divorce, ef_regulation_labor, ef_regulation)

#The dataset is filtered out in terms of the specified columns. This code counts for the number of NAs in each column
joinedDataSet %>% filter(is.na(Year)) %>% count()
joinedDataSet %>% filter(is.na(`Country/Region of Destination`)) %>% count()
joinedDataSet %>% filter(is.na(`Country of Origin`)) %>% count()
joinedDataSet %>% filter(is.na(`Number of People Immigrating Out of Country`)) %>% count()
joinedDataSet %>% filter(is.na(region)) %>% count()
joinedDataSet %>% filter(is.na(pf_religion)) %>% count()
joinedDataSet %>% filter(is.na(pf_identity_sex)) %>% count()
joinedDataSet %>% filter(is.na(pf_rol_procedural)) %>% count()
joinedDataSet %>% filter(is.na(pf_ss_disappearances_disap)) %>% count()
joinedDataSet %>% filter(is.na(pf_movement_women)) %>% count()
joinedDataSet %>% filter(is.na(pf_association_association)) %>% count()
joinedDataSet %>% filter(is.na(pf_association_assembly)) %>% count()
joinedDataSet %>% filter(is.na(pf_expression)) %>% count()
joinedDataSet %>% filter(is.na(pf_identity_divorce)) %>% count()
joinedDataSet %>% filter(is.na(ef_regulation_labor)) %>% count()
joinedDataSet %>% filter(is.na(ef_regulation)) %>% count()

#Filtered out rows that did not have any numbers (only NA. This is because they were not going to be of use for the rest of the project. I also changed the class of the Immigration Variable to integer
joinedDataSet<- joinedDataSet%>%filter(!if_all(c(4, 6:16), is.na))

joinedDataSet$`Number of People Immigrating Out of Country` <- as.integer(joinedDataSet$`Number of People Immigrating Out of Country`)

#New variable created
joinedDataSet<- joinedDataSet %>% arrange(`Country of Origin`, `Country/Region of Destination`) %>% mutate(ChangeInImmigration = (`Number of People Immigrating Out of Country`-lag(`Number of People Immigrating Out of Country`)) /lag(`Number of People Immigrating Out of Country`))

joinedDataSet %>% filter(is.na(ChangeInImmigration)) %>% count()

#Freqeuncy of Each Categorical Variable
joinedDataSet %>% group_by(`Country/Region of Destination`) %>% count()
joinedDataSet %>% group_by(`Country of Origin`) %>% count()

#Summary Statistic Accounting for Two Categorical Variables

#joinedDataSet %>% group_by(`Country of Origin`, `Country/Region of Destination`) %>% summarise_at(c(2:4), mean, na.rm = TRUE)

#SSTwoCat<- joinedDataSet %>% group_by(`Country of Origin`, `Country/Region of Destination`) %>% summarise_at(c(2:4), .funs = list(mean=mean, sd=sd, median=median, min=min, max=max), na.rm = TRUE) %>% filter(`Number of People Immigrating Out of Country`!=)



#Summary Statistic Accounting for Country of Origin as a Categorical Variable
joinedDataSet %>% group_by(`Country of Origin`) %>% summarise_at(c(3, 5:16), mean, na.rm = TRUE) 

SSOneCat<- joinedDataSet %>% group_by(`Country of Origin`) %>% summarise_at(c(3, 5:16), .funs = list(mean=mean, sd=sd, median=median, min=min, max=max), na.rm = TRUE) %>% pivot_longer(-1) 

SSOneCat<- SSOneCat %>% mutate(`name`=str_replace_all(`name`, "pf_re", "pf re")) %>% mutate(`name`=str_replace_all(`name`, "pf_identity_s", "pf identity s")) %>% mutate(`name`=str_replace_all(`name`, "pf_rol_pro", "pf rol pro")) %>% mutate(`name`=str_replace_all(`name`, "pf_ss_disappearances_d", "pf ss disappearances d")) %>% mutate(`name`=str_replace_all(`name`, "pf_movement_w", "pf movement w")) %>% mutate(`name`=str_replace_all(`name`, "pf_association_ass", "pf association ass"))  %>% mutate(`name`=str_replace_all(`name`, "pf_ex", "pf ex")) %>% mutate(`name`=str_replace_all(`name`, "pf_identity_divorce", "pf identity divorce")) %>% mutate(`name`=str_replace_all(`name`, "ef_regulation_lab", "ef regulation lab")) %>% mutate(`name`=str_replace_all(`name`, "ef_regulation", "ef regulation"))
SSOneCat <- SSOneCat %>% separate(name, into=c("name","stat"), sep="_") %>% pivot_wider()

#SummaryStatistic Not Accounting for Any Categorical Variable

SSNumerical<- joinedDataSet %>% summarise_at(c(4, 6:17), .funs = list(mean=mean, sd=sd, median=median, min=min, max=max), na.rm = TRUE) %>% pivot_longer(c(1:65))

SSNumerical<- SSNumerical %>% mutate(`name`=str_replace_all(`name`, "pf_re", "pf re")) %>% mutate(`name`=str_replace_all(`name`, "pf_identity_s", "pf identity s")) %>% mutate(`name`=str_replace_all(`name`, "pf_rol_pro", "pf rol pro")) %>% mutate(`name`=str_replace_all(`name`, "pf_ss_disappearances_d", "pf ss disappearances d")) %>% mutate(`name`=str_replace_all(`name`, "pf_movement_w", "pf movement w")) %>% mutate(`name`=str_replace_all(`name`, "pf_association_ass", "pf association ass"))  %>% mutate(`name`=str_replace_all(`name`, "pf_ex", "pf ex")) %>% mutate(`name`=str_replace_all(`name`, "pf_identity_divorce", "pf identity divorce")) %>% mutate(`name`=str_replace_all(`name`, "ef_regulation_lab", "ef regulation lab")) %>% mutate(`name`=str_replace_all(`name`, "ef_regulation", "ef regulation"))

SSNumerical <- SSNumerical %>% separate(name, into=c("name","stat"), sep="_") %>% pivot_wider()

#SummaryStatistics<- SummaryStatistics %>% kable(digits = 3, align = 'c', col.names=str_to_title(names(.)))
#SummaryStatistics %>% gt %>% tab_header(title=md("**Summary Statistics**"))



```

The first step I made sure to do is to turn any blank observations or any observations with .. into NA values. I also turned the Number of People Immigrating column into integer values. 



#### Visualizing

```{R}
library(ggplot2)

joinedDataSetpfreligonandNumberofPeople <- joinedDataSet %>% filter(Year==2015) %>% filter(`Number of People Immigrating Out of Country`!=0)

ggplot(joinedDataSetpfreligonandNumberofPeople, aes(`Number of People Immigrating Out of Country`, pf_religion))+ geom_point(size=0.2, aes(color= `region`)) +ggtitle("Relationship between Religious Freedom and Number of People Leaving a Country")+xlab("Number of People Leaving Country")+ylab("Religion Index Score")

ggplot(ChickWeight, aes(Time, weight)) + 
  geom_line(aes(group = Chick, color = Chick)) +
  geom_point(color = "white") +
  ggtitle("Chick Weights Over 2-Day Intervals")+xlab("Days")+ylab("Chick Weight (g)") +
  theme(legend.position = "none") + 
  facet_grid(rows = vars(Diet))
                                                                                                  
```

Your discussion of plot 1

```{R}

joinedDataSet %>% group_by(`Country of Origin`) %>% filter(!is.na(`Number of People Immigrating Out of Country`)) %>% summarise("Total Number of People Immigrating Out of Country" = sum(`Number of People Immigrating Out of Country`))  %>% arrange(`Total Number of People Immigrating Out of Country`)

joinedDataSet %>% group_by(`Country of Origin`) %>% filter(!is.na(`Number of People Immigrating Out of Country`)) %>% summarise("Total Number of People Immigrating Out of Country" = sum(`Number of People Immigrating Out of Country`)) %>% arrange(desc(`Total Number of People Immigrating Out of Country`))

Top5Low5ByNumberOfPeopleLeaving <- joinedDataSet %>% filter(!is.na(`Number of People Immigrating Out of Country`)) %>% filter(`Country of Origin`=="United States"|`Country of Origin`=="United Kingdom"|`Country of Origin`=="Russia"|`Country of Origin`=="India"|`Country of Origin`=="France"|`Country of Origin`=="Bhutan"|`Country of Origin`=="Swaziland"|`Country of Origin`=="Timor-Leste"|`Country of Origin`=="Brunei Darussalam"|`Country of Origin`=="Pap. New Guinea")
                                                       
ggplot(Top5Low5ByNumberOfPeopleLeaving, aes(x = `Number of People Immigrating Out of Country`, fill=`Country of Origin`))+ geom_bar(position='fill')

ggplot(Top5Low5ByNumberOfPeopleLeaving, aes(Year, `Number of People Immigrating Out of Country`, color = `Country of Origin`)) + geom_point() + 
    geom_step(stat = "summary", fun.y = mean) + geom_point(stat = "summary", 
    fun.y = mean, geom = "point", shape = "cross", size = 4, 
    color = "black")

ggplot(Top5Low5ByNumberOfPeopleLeaving, aes(`Number of People Immigrating Out of Country`, pf_religion))+ geom_point(size=0.2, aes(color= `Country of Origin`)) + ggtitle("Relationship between Religious Freedom and Number of People Leaving a Country")+xlab("Number of People Leaving Country")+ylab("Religion Index Score") + facet_grid(rows = vars(Year))



ggplot(joinedDataSet, aes(x = `Number of People Immigrating Out of Country`, fill=region))+ geom_bar(position='fill')




```

Your discussion of plot 2

```{R}

```

Your discussion of plot 3

#### Concluding Remarks

If any!




